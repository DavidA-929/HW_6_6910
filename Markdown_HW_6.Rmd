---
title: 'STAT 6910: HW 6'
author: "David Angeles"
output:
  pdf_document:
    keep_tex: yes
  html_document:
    df_print: paged
fontsize: 12pt
---

```{r, echo=FALSE}
library(pwr)
library("emmeans")
```


## Problem 1

Under what circumstances should the two-way main effects model (6.2.3) be used rather than the two-way complete model (6.2.2)? [1 sentence may suffice.] Discuss the interpretation of main effects in each model. [You can focus on comparing the interpretations of, e.g., $\alpha_1 - \alpha_2$ vs. $\alpha_1^\star - \alpha_2^\star$ in these models.]

#### Answer:

The two-way main effects model (6.2.3) should be used rather than the two-way complete model (6.2.2) when an experimenter has sufficient knowledge about the two treatment factors being studied to state with reasonable certainty that the factors do not interact.

Using the main effects model, one cannot compare the effects of the different levels of the factors, say level 1 of $A$, $\alpha_1$, with level 2 of $A$, $\alpha_2$. Instead, one must compare the efects of the different levels of $A$ averaged over the effects of $B$. So, $\alpha_1-\alpha_2$ is not estimable, but 
$\alpha^\star_2-\alpha^\star_1=\bar{\tau}_{2\bullet}-\bar{\tau}_{1\bullet}$ is estimable.


## Problem 2


Verify that $(\tau_{ij} - \bar{\tau}_{i\bullet} - \bar{\tau}_{\bullet j} + \bar{\tau}_{\bullet \bullet})$ is an interaction contrast for the two-way complete model. Write down the list of contrast coefficients in terms of the  $\tau_{ij}$’s when factor $A$ has $a = 3$ levels and factor $B$ has $b=4$ levels. [For the second part (“Write down the list of contrast coefficients...”) set $i=1$ and $j = 3$.]



## Problem 7 part (a)


The data shown in Table 6.22 are a subset of the data given by Anderson and McLean (1974) and show the strength of a weld in a steel bar. Two factors of interest were gage bar setting (the distance the weld die travels during the automatic weld cycle) and time of welding (total time of the automatic weld cycle). Assume that the levels of both factors were selected to be equally spaced.


```{r}
weld.data = read.table("~/Desktop/Stats 6910/HW_4_and_5/weld.strength.txt", header = TRUE)
weld.data$trtmt <- as.factor(weld.data$trtmt)
```

(a) Using the cell-means model (6.2.1) for these data, test the hypothesis that there is no difference in the effects of the treatment combinations on weld strength against the alternative hypothesis that at least two treatment combinations have different effects.



```{r, fig.width= 4,fig.height=4, fig.align= "center"}
cell_model <- aov(strength ~ trtmt , data = weld.data)
```

(c) Construct an analysis of variance table and test the hypothesis that color has no effect in inflation time.

Let $\tau_{ij}$ be the deviation from the overall weld strength, $\mu$, when factor $A$, the gage bar setting, has level $i$ and factor $B$, the time of welding, had level $j$. Using an $\alpha$-level of $\alpha = 0.05$, and the following test: 

\begin{center}
 The Null Hypothesis of No Effect on Weld Stength  
 $H_0 : \tau_{ij} = 0 \hspace{.2cm }\forall \hspace{.1cm} i=1,2,...,a \text{ and }\forall  \hspace{.1cm} j=1,2,...,b$ \\
 vs. The Alternative Hypothesis of Some Effect on Weld Strength $H_A : \tau_{ij} \neq \tau_{hk}$ for some $i\neq h$ and $j\neq k$ 
\end{center}

```{r}
anova(cell_model)
```

From the analysis of variance table we obtain a $p$-value equal to $0.0001$, which is less that the $\alpha$-level of $\alpha = 0.05$. Therefore, we can reject the null hypothesis of no effect on welding strength in favor of the alternative hypothesis of some effect on welding stengh.


## Problem 8

For the experiment described in Exercise 7, use the two-way complete model instead of the equivalent cell means model.

(a) Test the hypothesis of no interaction between gage bar setting and time of weld and state your conclusion. 


Let $\tau_{ij}$ be the deviation from the overall weld strength, $\mu$, when factor $A$, the gage bar setting, has level $i$ and factor $B$, the time of welding, had level $j$. Using an $\alpha$-level of $\alpha = 0.05$, since the sample sizes are all equal, $r_{ij}=2$, we can use the following test: 

\begin{center}
 The Null Hypothesis of No Interaction Bewteen $A$ and $B$  
 $H_0 : (\alpha \beta)_{ij} - (\alpha \beta)_{iq} - (\alpha \beta)_{sj} + (\alpha \beta)_{sq}= 0 \hspace{.2cm }\forall \hspace{.1cm} i<s \text{ and }\forall  \hspace{.1cm} j<j$ \\
 vs. The Alternative Hypothesis of Some Effect on Weld Strength $H_A :  (\alpha \beta)_{ij} - (\alpha \beta)_{iq} \neq (\alpha \beta)_{sj} - (\alpha \beta)_{sq}$ for some $i\neq s$ and $j\neq q$ 
\end{center}

```{r}
weld.data$gage <- as.factor(weld.data$gage)
weld.data$time <- as.factor(weld.data$time)
```

```{R}
model_AB <- aov(strength ~ gage*time, data = weld.data)
anova(model_AB)
```


From the analysis of variance table we obtain a $p$-value equal to $0.0008$, which is less that the $\alpha$-level of $\alpha = 0.05$. Therefore, we can reject the null hypothesis of no effect on welding strength in favor of the alternative hypothesis of some effect on welding stengh.

(b) Draw an interaction plot for the two factors Gage bar setting and Time of welding. Does your interaction plot support the conclusion of your hypothesis test? Explain.

```{r}
attach(weld.data)
par(mfrow = c(1, 2))
interaction.plot(x.factor = gage, trace.factor = time, response = strength,
col = c(1, 2, 3, 4), leg.bty = "o", leg.bg = "white") 
interaction.plot(x.factor = time, trace.factor = gage, response = strength,
col = c(1, 2, 3), leg.bty = "o", leg.bg = "white")
```

(c) In view of your answer to part (b), is it sensible to investigate the differences between the effects of gage bar setting? Why or why not? Indicate on your plot what would be compared.


## Problem 21 

The experiment was run in order to examine the amount of time taken to boil a given amount of water on the four different burners of her stove, and with 0, 2, 4, or 6 teaspoons of salt added to the water. Thus the experiment had two treatment factors with four levels each. The experimenter ran the experiment as a completely randomized design by taking $r = 3$ observations on each of the 16 treatment combinations in a random order. The data are shown in Table 6.26. The experimenter believed that there would be no interaction between the two factors.

```{r}
boiling.data = read.table("~/Desktop/Stats 6910/HW_4_and_5/water.boiling.txt", 
                            header = TRUE)
# make salt and burner factors and add column of two digit treatment combination
boiling.data <- within(boiling.data,{
   f_salt = factor(salt); f_burner = factor(burner)
   trtmt= factor(10*burner + salt)})
# Display boiling.data
head(boiling.data, 10)
```

(a) Check the assumptions on the two-way main-effects model.

```{r}
two.way_model <- aov(time ~ f_salt*f_burner, data = boiling.data)

boiling.data = within(boiling.data, {
  # Compute predicted, residual, and standardized residual values
  ypred = fitted(two.way_model)
  e = resid(two.way_model) 
  z = rstandard(two.way_model)})
# Display first 10 lines of boiling.data, 4 digits per variable
print(head(boiling.data, 10), digits = 4)


# Generate residual plots 
par(mfrow = c(1,3))
plot(z ~ order, data=boiling.data, 
     main= "Order vs. Std. Residuals",
     ylab="Std. Residuals", las=1)
abline(h=0)
plot(z ~ ypred, data=boiling.data, 
      main= "Fitted Values vs. Std. Residuals",
     ylab="Std. Residuals", las=1)
abline(h=0)
qqnorm(boiling.data$z)
# Line through 1st and 3rd quantile points
qqline(boiling.data$z) 



```


Assumption (a): The error have mean 0:

Due to the formulation of the One Way ANOVA Model, the residuals always sum up to 0. Hence, the assumption cannot be checked.

Assumption (b): The error have constant variance:

```{r}
Y_i_var <- tapply(spaghetti.data$weight, spaghetti.data$trtmt, var);
max(Y_i_var)/min(Y_i_var)
```

Using the rule of thumb based on within group variances we can see that 
$$\frac{\max_i\{S_i^2 \}}{\min_i\{S_i^2 \}} =\frac{49}{2.33} = 21.$$ 
Furthermore, by plotting the standardized residuals against the fitted values we can see that the spread of the standardized residuals increases as the fitted values increase. Hence, with these two results we feel comfortable to say that the equal variance assumption is not satisfied. 

Assumption (c): The error are normally distributed:

```{r}
max(abs(spaghetti.data$z))
```

From the qq-plot above we see that the data is fairly straight. Furthermore, all the standardized residuals are $|z_i| \leq 2.437$, so we don't have any apparent outliers. Therefore, the normality assumption is reasonable.


Assumption (d): The errors are independent:

From the plot of Order vs. Residuals we can see that there isn't a pattern as time increases. Therefore we feel comfortable that the errors are approximately satisfies.



(b) Calculate a 99% set of Tukey confidence intervals for pairwise differences between the levels of salt, and calculate separately a 99% set of intervals for pairwise differences between the levels of burner.

```{r}
em.salt <- emmeans(two.way_model, specs = ~f_salt)
em.burner <- emmeans(two.way_model, specs = ~f_burner)

contrast(em.salt, method = "tukey")
```


 
 
```{r}
contrast(em.burner, method ="tukey")
```


